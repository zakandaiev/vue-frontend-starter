{"version":3,"file":"C3aOsh7_.js","sources":["../../src/composable/auth-middleware.js","../../src/view/auth/Login.vue"],"sourcesContent":["import Translation from '@/i18n/translation';\nimport { useAuthStore } from '@/store';\nimport { onMounted, ref, watch } from 'vue';\nimport { useRouter } from 'vue-router';\n\nfunction useAuthMiddleware(options = {}) {\n  const {\n    preReadyCallback,\n    postReadyCallback,\n    redirectToLoginPage = true,\n  } = options;\n\n  const authStore = useAuthStore();\n  const router = useRouter();\n  const isReady = ref(false);\n\n  onMounted(() => {\n    init();\n  });\n\n  watch(\n    () => authStore.isAuthenticated,\n    () => {\n      // Current page is not \"login\" and user is not authenticated so redirect him to \"login\" page\n      // Or\n      // Current page is \"login\" and user is authenticated so redirect him to \"home\" page\n      if (\n        (redirectToLoginPage && !authStore.isAuthenticated)\n        || (!redirectToLoginPage && authStore.isAuthenticated)\n      ) {\n        doRedirect();\n      }\n    },\n  );\n\n  async function init() {\n    // Current page is not \"login\" and user is not authenticated so redirect him to \"login\" page\n    // Or\n    // Current page is \"login\" and user is authenticated so redirect him to \"home\" page\n    if (\n      (redirectToLoginPage && !authStore.isAuthenticated)\n      || (!redirectToLoginPage && authStore.isAuthenticated)\n    ) {\n      await doRedirect();\n      return true;\n    }\n\n    if (typeof preReadyCallback === 'function') {\n      await preReadyCallback();\n    }\n\n    isReady.value = true;\n\n    if (typeof postReadyCallback === 'function') {\n      await postReadyCallback();\n    }\n\n    return true;\n  }\n\n  async function doRedirect() {\n    await router.replace(\n      Translation.i18nRoute({\n        name: redirectToLoginPage ? 'login' : 'home',\n      }),\n    );\n    return true;\n  }\n\n  return {\n    isReady,\n    doRedirect,\n  };\n}\n\nexport default useAuthMiddleware;\n","<script setup>\nimport Footer from '@/component/footer/Footer.vue';\nimport Header from '@/component/header/Header.vue';\nimport Loader from '@/component/loader/Loader.vue';\nimport { updateSEO, useAuthMiddleware } from '@/composable';\nimport { useAuthStore } from '@/store';\nimport { ref } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nconst { t, te } = useI18n();\nconst { doRedirect, isReady } = useAuthMiddleware({ redirectToLoginPage: false });\nconst authStore = useAuthStore();\n\nupdateSEO({ t, te });\n\nconst email = ref('');\nconst password = ref('');\nconst isLoading = ref(false);\n\nasync function handleLogin(event) {\n  event.preventDefault();\n\n  if (isLoading.value) {\n    return false;\n  }\n\n  isLoading.value = true;\n\n  const result = await authStore.login({\n    email: email.value,\n    password: password.value,\n  });\n\n  isLoading.value = false;\n\n  if (!result) {\n    return false;\n  }\n\n  doRedirect();\n}\n</script>\n\n<template>\n  <Header />\n\n  <main class=\"page-content\">\n    <div class=\"container\">\n      <div class=\"login\">\n        <h1 class=\"login__title\">\n          {{ t('title') }}\n        </h1>\n\n        <form\n          v-if=\"isReady\"\n          class=\"box login__form\"\n          :disabled=\"isLoading\"\n          @submit=\"handleLogin\"\n        >\n          <label>\n            {{ t('email_label') }}\n          </label>\n          <input\n            v-model=\"email\"\n            type=\"email\"\n            minlength=\"8\"\n            :placeholder=\"t('email_placeholder')\"\n          >\n\n          <label class=\"mt-2\">\n            {{ t('password_label') }}\n          </label>\n          <input\n            v-model=\"password\"\n            type=\"password\"\n            minlength=\"8\"\n            :placeholder=\"t('password_placeholder')\"\n          >\n\n          <div\n            v-if=\"isLoading\"\n            class=\"login__loader mt-2\"\n          >\n            <Loader />\n          </div>\n          <button\n            v-else\n            type=\"submit\"\n            class=\"btn btn_primary mt-2\"\n            :disabled=\"isLoading\"\n            @click=\"handleLogin\"\n          >\n            {{ t('submit') }}\n          </button>\n        </form>\n\n        <div\n          v-else\n          class=\"box login__loader\"\n        >\n          <Loader />\n        </div>\n      </div>\n    </div>\n  </main>\n\n  <Footer />\n</template>\n\n<style lang=\"scss\" scoped>\n@import './Login.scss';\n</style>\n\n<i18n src=\"./Login.json\" />\n"],"names":["useAuthMiddleware","options","preReadyCallback","postReadyCallback","redirectToLoginPage","authStore","useAuthStore","router","useRouter","isReady","ref","onMounted","init","watch","doRedirect","Translation","te","useI18n","updateSEO","email","password","isLoading","handleLogin","event","result","_createVNode","Header","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_unref","_createElementBlock","$event","_hoisted_7","_openBlock","_hoisted_9","Loader","_hoisted_10","_hoisted_11","Footer"],"mappings":"qNAKA,SAASA,EAAkBC,EAAU,GAAI,CACvC,KAAM,CACJ,iBAAAC,EACA,kBAAAC,EACA,oBAAAC,EAAsB,EAC1B,EAAMH,EAEEI,EAAYC,EAAY,EACxBC,EAASC,EAAS,EAClBC,EAAUC,EAAI,EAAK,EAEzBC,EAAU,IAAM,CACdC,EAAI,CACN,CAAC,EAEDC,EACE,IAAMR,EAAU,gBAChB,IAAM,EAKDD,GAAuB,CAACC,EAAU,iBAC/B,CAACD,GAAuBC,EAAU,kBAEtCS,EAAU,CAEd,CACJ,EAEE,eAAeF,GAAO,CAIpB,OACGR,GAAuB,CAACC,EAAU,iBAC/B,CAACD,GAAuBC,EAAU,iBAEtC,MAAMS,EAAU,EACT,KAGL,OAAOZ,GAAqB,YAC9B,MAAMA,EAAgB,EAGxBO,EAAQ,MAAQ,GAEZ,OAAON,GAAsB,YAC/B,MAAMA,EAAiB,EAGlB,GACT,CAEA,eAAeW,GAAa,CAC1B,aAAMP,EAAO,QACXQ,EAAY,UAAU,CACpB,KAAMX,EAAsB,QAAU,MAC9C,CAAO,CACP,EACW,EACT,CAEA,MAAO,CACL,QAAAK,EACA,WAAAK,CACJ,CACA,qlCChEA,KAAM,CAAE,EAAG,GAAAE,CAAE,EAAKC,EAAO,EACnB,CAAE,WAAAH,EAAY,QAAAL,CAAO,EAAKT,EAAkB,CAAE,oBAAqB,GAAO,EAC1EK,EAAYC,EAAY,EAE9BY,EAAU,CAAE,EAAG,GAAAF,EAAI,EAEnB,MAAMG,EAAQT,EAAI,EAAE,EACdU,EAAWV,EAAI,EAAE,EACjBW,EAAYX,EAAI,EAAK,EAE3B,eAAeY,EAAYC,EAAO,CAGhC,GAFAA,EAAM,eAAc,EAEhBF,EAAU,MACZ,MAAO,GAGTA,EAAU,MAAQ,GAElB,MAAMG,EAAS,MAAMnB,EAAU,MAAM,CACnC,MAAOc,EAAM,MACb,SAAUC,EAAS,KACvB,CAAG,EAID,GAFAC,EAAU,MAAQ,GAEd,CAACG,EACH,MAAO,GAGTV,EAAU,CACZ,6BAIEW,EAAUC,CAAA,EAEVC,EA0DO,OA1DPC,EA0DO,CAzDLD,EAwDM,MAxDNE,EAwDM,CAvDJF,EAsDM,MAtDNG,EAsDM,CArDJH,EAEK,KAFLI,EAEKC,EADAC,EAAA,CAAA,EAAC,OAAA,CAAA,EAAA,CAAA,EAIEA,EAAAxB,CAAA,OADRyB,EAyCO,OAAA,OAvCL,MAAM,kBACL,SAAUb,EAAA,MACV,SAAQC,IAETK,EAEQ,eADHM,EAAA,CAAA,EAAC,aAAA,CAAA,EAAA,CAAA,IAENN,EAKC,QAAA,sCAJUR,EAAK,MAAAgB,GACd,KAAK,QACL,UAAU,IACT,YAAaF,EAAA,CAAA,EAAC,mBAAA,iBAHNd,EAAA,KAAK,IAMhBQ,EAEQ,QAFRS,EAEQJ,EADHC,EAAA,CAAA,EAAC,gBAAA,CAAA,EAAA,CAAA,IAENN,EAKC,QAAA,sCAJUP,EAAQ,MAAAe,GACjB,KAAK,WACL,UAAU,IACT,YAAaF,EAAA,CAAA,EAAC,sBAAA,iBAHNb,EAAA,KAAQ,IAOXC,EAAA,OADRgB,IAAAH,EAKM,MALNI,EAKM,CADJb,EAAUc,CAAA,UAEZL,EAQS,SAAA,OANP,KAAK,SACL,MAAM,uBACL,SAAUb,EAAA,MACV,QAAOC,KAELW,EAAA,CAAA,EAAC,QAAA,CAAA,EAAA,EAAAO,CAAA,YAIRH,IAAAH,EAKM,MALNO,EAKM,CADJhB,EAAUc,CAAA,WAMlBd,EAAUiB,CAAA"}